<!-- dashboard-component.html -->
<div class="super-container">
  <app-sidebar-component></app-sidebar-component>
  <div class="dashboard-container">
    <div class="dashboard-content">
      <!-- Header -->
      <div class="header">
        <img id="logo" src="/logo.png" alt="" />
        <div class="title-container">
          <div>
            <h1 class="title">¡Bienvenido de nuevo!</h1>
            <p class="subtitle">Continúa tu viaje de aprendizaje en CodeQuest</p>
          </div>
        </div>

        <!-- Streak Card -->
        <div class="streak-card">
          <div class="streak-flame">
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"
              />
            </svg>
            <div class="flame-particles">
              <span class="particle"></span>
              <span class="particle"></span>
              <span class="particle"></span>
            </div>
          </div>
          <div class="streak-info">
            <div class="streak-number">{{ streak }}</div>
            <div class="streak-label">Días de Racha</div>
            <div class="streak-progress">
              <div class="streak-progress-bar">
                <div class="streak-progress-fill"></div>
              </div>
              <span class="streak-goal">¡Sigue así!</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="main-grid">
        <!-- Current Courses -->
        <div class="section courses-section">
          <div class="section-header">
            <svg
              class="section-icon"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
            </svg>
            <h2>Mis Cursos</h2>
          </div>

          <!-- Sección de cursos actualizada -->
          <div class="courses-container">
            <div
              *ngFor="let userCourse of getPaginatedCourses(userCourses$ | async); let i = index"
              class="course-card-new"
              [style.animation-delay.s]="i * 0.1"
            >
              <div class="course-card-content" (click)="openCourse(userCourse.course.id)">
                <!-- Imagen del thumbnail a la izquierda (desde Course) -->
                <div class="course-image-container">
                  <img
                    [src]="userCourse.course?.thumbnail"
                    [alt]="userCourse.course?.title"
                    class="course-thumbnail"
                  />
                  <!-- Badge de estado (desde UserCourse) -->
                  <div
                    class="status-badge-overlay"
                    [class]="'status-' + userCourse.status.toLowerCase()"
                  >
                    {{ getStatusLabel(userCourse.status) }}
                  </div>
                </div>

                <!-- Información del curso a la derecha -->
                <div class="course-info-new">
                  <div class="course-header-new">
                    <!-- Título desde Course -->
                    <h3 class="course-title">{{ userCourse.course?.title }}</h3>
                    <!-- Categoría desde Course -->
                    <span class="category-badge">{{ userCourse.course?.category }}</span>
                  </div>

                  <div class="course-meta-new">
                    <!-- Level desde Course -->
                    <span class="level-badge">{{ userCourse.course?.level }}</span>
                    <!-- Rating y estudiantes desde Course -->
                    <span class="rating-new">
                      ⭐ {{ userCourse.course?.rating }} ({{
                        userCourse.course?.students?.toLocaleString()
                      }})
                    </span>
                  </div>

                  <!-- Información de progreso específica del usuario (desde UserCourse) -->
                  <div class="course-lessons-new">
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M9 11l3 3L22 4" />
                      <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                    </svg>
                    {{ userCourse.completedLessons || 0 }} de
                    {{ userCourse.course?.lessons || 0 }} lecciones completadas
                  </div>

                  <!-- Próxima lección desde UserCourse -->
                  <div class="next-lesson-new" *ngIf="userCourse.nextLesson">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polygon points="5 3 19 12 5 21 5 3" />
                    </svg>
                    Siguiente: {{ userCourse.nextLesson }}
                  </div>

                  <!-- Módulo actual desde UserCourse -->
                  <div class="current-module" *ngIf="userCourse.currentModule">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                    </svg>
                    Módulo actual: {{ userCourse.currentModule }}
                  </div>

                  <!-- Instructor desde Course -->
                  <div class="instructor-info-new">
                    <small
                      >Instructor: {{ userCourse.course.instructor?.name || 'No asignado' }}</small
                    >
                  </div>

                  <!-- Último acceso desde UserCourse -->
                  <div class="last-accessed" *ngIf="userCourse.lastAccessed">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <circle cx="12" cy="12" r="10" />
                      <polyline points="12 6 12 12 16 14" />
                    </svg>
                    Último acceso: {{ formatDate(userCourse.lastAccessed) }}
                  </div>
                </div>
              </div>

              <!-- Barra de progreso desde UserCourse -->
              <div class="progress-container-new">
                <div class="progress-bar-container">
                  <div class="progress-bar" [style.width.%]="getCourseProgress(userCourse)"></div>
                </div>
                <div class="progress-text">{{ getCourseProgress(userCourse) }}%</div>
              </div>
            </div>

            <!-- Mensaje cuando no hay cursos -->
            <div class="no-courses" *ngIf="(userCourses$ | async)?.length === 0">
              <svg
                width="64"
                height="64"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
              </svg>
              <h3>No tienes cursos inscritos</h3>
              <p>Explora nuestro catálogo y comienza tu viaje de aprendizaje</p>
            </div>
          </div>

          <!-- Paginación -->
          <div class="pagination-container" *ngIf="totalCourses > pageSize">
            <div class="pagination-controls">
              <button
                class="pagination-btn"
                (click)="previousPage()"
                [disabled]="currentPage === 0"
                [class.disabled]="currentPage === 0"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Anterior
              </button>

              <div class="pagination-numbers">
                <button
                  *ngFor="let page of pageNumbers"
                  class="page-number"
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)"
                >
                  {{ page + 1 }}
                </button>
              </div>

              <button
                class="pagination-btn"
                (click)="nextPage()"
                [disabled]="currentPage >= totalPages - 1"
                [class.disabled]="currentPage >= totalPages - 1"
              >
                Siguiente
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </button>
            </div>

            <div class="pagination-info">
              Página {{ currentPage + 1 }} de {{ totalPages }} - Mostrando
              {{ getPaginatedCourses(userCourses$ | async).length }} de {{ totalCourses }} cursos
            </div>
          </div>
        </div>

        <div class="right-column">
          <!-- Weekly Activity -->
          <div class="section activity-section">
            <div class="section-header">
              <svg
                class="section-icon"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
              </svg>
              <h2>Actividad Semanal</h2>
            </div>

            <div class="activity-chart">
              <div
                *ngFor="let day of weeklyActivity$ | async; let i = index"
                class="activity-bar-wrapper"
              >
                <div
                  class="activity-bar"
                  [style.height.px]="day.value * 20"
                  [class.active]="day.value > 3"
                  [style.animation-delay.s]="i * 0.1"
                ></div>
                <span class="day-label">{{ day.day }}</span>
              </div>
            </div>
          </div>

          <!-- Stats Container -->
          <div class="stats-container">
            <div class="stat-card" [class.animate-pulse]="animateStats">
              <svg
                class="stat-icon"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"
                />
              </svg>
              <div class="stat-value">{{ streak }}</div>
              <div class="stat-label">Días de racha</div>
            </div>
            <div class="stat-card gold" [class.animate-pulse]="animateStats">
              <svg
                class="stat-icon gold"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10" />
                <path d="M12 6v6l4 2" />
              </svg>
              <div class="stat-value gold">{{ coins }}</div>
              <div class="stat-label">CodeCoins</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Wishlist Section -->
      <div class="section horizontal-section wishlist-section">
        <div class="section-header">
          <svg
            class="section-icon gold"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polygon
              points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
            />
          </svg>
          <h2>Lista de Deseos</h2>
        </div>

        <div class="horizontal-scroll-container">
          <div class="horizontal-scroll-content">
            <div
              *ngFor="let course of wishlistCourses$ | async; let i = index"
              class="wishlist-card"
              [style.animation-delay.s]="i * 0.1"
            >
              <div class="wishlist-image-container" (click)="openCourse(course!.id)">
                <img [src]="course.image" [alt]="course.title" class="wishlist-image" />
                <div class="wishlist-overlay">
                  <svg
                    width="40"
                    height="40"
                    viewBox="0 0 24 24"
                    fill="white"
                    stroke="white"
                    stroke-width="2"
                  >
                    <polygon points="5 3 19 12 5 21 5 3" />
                  </svg>
                </div>
              </div>
              <div class="wishlist-content">
                <h4>{{ course.title }}</h4>
                <div class="wishlist-meta">
                  <span class="level-badge">{{ course.level }}</span>
                  <span class="duration">{{ course.duration }}</span>
                </div>
                <div class="students-count">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                  </svg>
                  {{ course.students!.toLocaleString() }} estudiantes
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Achievements Section -->
      <div class="section horizontal-section achievements-section">
        <div class="section-header">
          <svg
            class="section-icon"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
            <path d="M4 22h16" />
            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
          </svg>
          <h2>Logros Recientes</h2>
        </div>

        <div class="horizontal-scroll-container">
          <div class="horizontal-scroll-content">
            <div
              *ngFor="let achievement of recentAchievements$ | async; let i = index"
              class="achievement-card"
              [attr.data-rarity]="achievement.rarity"
              [style.animation-delay.s]="i * 0.1"
            >
              <div class="achievement-icon" [attr.data-rarity]="achievement.rarity">
                {{ achievement.image }}
              </div>
              <div class="achievement-info">
                <div class="achievement-name">{{ achievement.name }}</div>
                <div class="achievement-date">{{ achievement.unlockDate }}</div>
              </div>
              <svg
                class="achievement-check"
                [attr.data-rarity]="achievement.rarity"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Achievements Section -->
      <div class="section horizontal-section upcoming-section">
        <div class="section-header">
          <svg
            class="section-icon accent"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10" />
            <polyline points="12 6 12 12 16 14" />
          </svg>
          <h2>Próximos Logros</h2>
        </div>

        <div class="horizontal-scroll-container">
          <div class="horizontal-scroll-content">
            <div
              *ngFor="let achievement of upcomingAchievements$ | async; let i = index"
              class="upcoming-card"
              [style.animation-delay.s]="0.5 + i * 0.1"
            >
              <div class="upcoming-header">
                <span class="upcoming-icon">{{ achievement.icon }}</span>
                <div class="upcoming-name">{{ achievement.name }}</div>
                <svg
                  class="lock-icon"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                  <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
              </div>
              <div class="upcoming-progress-bar">
                <div class="upcoming-progress" [style.width.%]="achievement.progress"></div>
              </div>
              <div class="upcoming-progress-text">{{ achievement.progress }}% completado</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
